- まず、UI側から確認できる機能としては、領域選択機能を残しましょう。で、やりたいのは何かというと、読み込み対象として「総合振込明細」「カード利用明細」のどちらかを選択した上で、「領域選択」に移れるようにするというもの。この際、領域選択して表抽出の機構は、Promptが違うだけで、コアの抽出機構は流用するものとする。
- すなわち、 本PJ bank-csv-grid/src　にある、各銀行明細の「タグ割り当て」の横に、PDF明細付与というボタンを配置し、そうすると、この画面に飛んでくるようにする。で、そうすると、割り当てる明細PDFが「総合振込」なのか「カード明細」なのかが、現在の「抽出モード」の選択の部分で選べるようになる。
- まず、このCSV抽出機構で達成するべきマスト要件は次だ：
    - <総合振込明細PDF>も<カード明細PDF>も最終的な【出力フォーマット】は、bank-csv-grid/src　の明細表示機構である「ID,銀行,取引日,内容,入金,出金,残高,メモ,タグ,登録済み」に挿入できるようになっていることだ
    - <総合振込明細PDF>の場合は、
        - 総合振込明細抽出モードをボタン選択
        - 明細の銀行を選択（プルタブ、本番の銀行選択と一致）
            - 選択した銀行ごとに裏側の抽出プロンプトが変更されるようになっていると好ましい。一旦はPromptは現行のままハードコードで構わない。
            - bank-csv-grid/src側に明細レコードを創出するとき「銀行」に選択銀行がアサインされる
        - PDF抽出は必ず下記対応
            - 【出力フォーマット】の「内容」には、PDFの「受取人名、銀行、支店、科目、口座番号」を文字列で結合してアサイン
            - 【出力フォーマット】の「入金」はいつでも「０」
            - 【出力フォーマット】の「出金」には、{振込金額,支払金額}タブの、数値をアサイン。ただし、￥マークや「円」文字、"-"や”､”は取り除いて純粋な数値オブジェクトとして扱えるようにすること。
            - 【出力フォーマット】の「出金」には、PDFレコードに単一レコードに（一つの行に）二つの数字が二行で並んでいるときは、必ず上の数値を採用すること。
            - 【出力フォーマット】の「残高」は、記入なし
            - 【出力フォーマット】の「メモ」には、「総合振込明細」と記入
        - 抽出した、表形式は、現在のようにUIで修正できるようにしておく。ただし、あくまでもPDF紐付け元のbank-csv-grid/src　側の明細レコードに紐づけることが目的なので、「紐付け実行」ボタンを用意する
        - 「紐付け実行ボタン」を押すと、紐付け先の明細（この場合は総合振込、表示の銀行明細レコード）はDeactivateして、内部勘定の登録はできなくなり、代わりに、その明細の下に、抽出してきた明細CSVが、INSERTされるというもの。ここまでできるようにしたい。
    - <カード明細PDF>の場合は、
        - カード明細抽出モードをボタン選択
        - カードの引き落としに使われている銀行を選択（プルタブ、本番の銀行選択と一致）
            - 選択した銀行がbank-csv-grid/src送出時の「銀行」にアサイン
        - PDF抽出は必ず下記対応
            - 【出力フォーマット】の「内容」には、PDFの「ご利用店名、ご利用先、摘要」を文字列で抽出して結合してアサイン
            - 【出力フォーマット】の「入金」はいつでも「０」
            - 【出力フォーマット】の「出金」には、{お支払金額}タブの、数値をアサイン。
                - ただし、￥マークや「円」文字、"-"や”､”は取り除いて純粋な数値オブジェクトとして扱えるようにすること。
                - <<重要>>また、カードの明細からの抽出なので「利用金額」ではなく、「支払金額」のレコードを抽出すること
            - 【出力フォーマット】の「残高」は、記入なし
            - 【出力フォーマット】の「メモ」には、「カード利用明細」と記入
        - 抽出した、表形式は、現在のようにUIで修正できるようにしておく。ただし、あくまでもPDF紐付け元のbank-csv-grid/src　側の明細レコードに紐づけることが目的なので、「紐付け実行」ボタンを用意する
        - 「紐付け実行ボタン」を押すと、紐付け先の明細（この場合はカード引落、表示の銀行明細レコード[ユーザーが選択済み]）はDeactivateして、内部勘定の登録はできなくなり、代わりに、その明細の下に、抽出してきた明細CSVが、INSERTされるというもの。ここまでできるようにしたい。

ここまでをできるようにしたい。まずは、「紐付け実行」ボタンから先の、Front・Backの開発やAPI繋ぎこみはおいておくとして。上記を実装してしまいたい。


