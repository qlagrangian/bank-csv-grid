あなたは TypeScript/React に精通したテックリード兼アーキテクトです。
これから、React-Data-Grid（RDG）と HyperFormula（HF）のリポジトリ、そして既存プロジェクトの AggregatePanel 実装を解析し、「資金繰り予測テーブル」を実装するための技術調査と設計方針をまとめてください。

# 1. コンテキスト

以下は本プロジェクトで実装したい「資金繰り予測テーブル」の要件です。

Path: ** bank-csv-grid/docs/04_prp.md **

# 2. 対象リポジトリ

- React-Data-Grid:
  - GitHub: https://github.com/Comcast/react-data-grid
  - 相対パス： ../react-data-grid/
- HyperFormula:
  - GitHub: https://github.com/handsontable/hyperformula
  - 相対パス： ../hyperformula/
- 自プロジェクト:
  - AggregatePanel（実績集計表）コンポーネントおよび関連コード一式
  - AggregatePanel で利用している行・列のキー構造、行スタック、列スタック定義

# 3. 調査・解析タスク

以下の観点で、RDG・HF・自前コードを解析し、要件との対応関係を整理してください。

## 3.1 React-Data-Grid の解析

1. RDG が提供する機能のうち、次の要件に直接関係する API / コンポーネント / パターンを特定し、簡潔に説明してください。

   - 行・列の定義（大量の月次列を扱うケース）
   - 行スタック / Summary rows / 合計・小計行の表現方法
   - Frozen columns（科目列固定）、ヘッダ固定
   - 列幅リサイズ、列順入れ替え
   - セル編集（カスタムエディタ・フォーマッタ）
   - キーボードナビゲーション（矢印キー、Enter、Tab）
   - コピー＆ペースト、フィルハンドル（onFill / onCellPaste 等）
   - 行・セルのスタイル指定（マイナス値の赤字表示、合計行の強調）

2. 上記要件に対して、
   - 「RDG の標準機能で素直に実現できる部分」
   - 「カスタム実装が前提になる部分」
   - 「制限・既知の課題（例: マルチセル選択の制約など）」
   を一覧化してください。

3. 実装上のベストプラクティスや推奨アーキテクチャ（例: `rows` と `columns` の型設計、`onRowsChange` の扱い方、仮想スクロール時の注意点）があれば整理してください。

## 3.2 HyperFormula の解析

1. HF が提供する機能のうち、以下の要件に関係する部分を特定し、API レベルで説明してください。

   - A1 形式のセル参照（単一セル・範囲）
   - 基本的な四則演算、および `SUM` などの基本関数
   - 行間・列間の依存関係の管理と自動再計算
   - 複数シートの扱い（必要であれば）
   - イベント（値更新通知など）と再計算タイミング
   - セルコンテンツ（値 / 式）の設定・取得方法

2. HF を「ヘッドレスの式エンジン」として利用し、RDG 側のセル編集と連携させる場合の典型的なフローを整理してください。
   - `rowIndex` / `column.key` を HF のシート座標にマッピングする方法
   - ユーザーが `=A1 * 1.1` 等の式を入力した場合の処理フロー
   - HF の再計算結果を RDG の `rows` に反映する処理フロー
   - KPI 行 / 計算行 / 定数行と HF の関係（どの行種別を HF の式に乗せるか）

3. HF 利用時の制約・注意点（ライセンス、パフォーマンス、シートサイズの上限など）を簡潔にまとめてください。

## 3.3 既存 AggregatePanel 実装との比較

1. AggregatePanel で現在使われている:
   - 行スタック（行定義）
   - 列スタック（列定義）
   - 合計・小計行の実装方法
   を読み取り、要件で定義した「予測テーブルの行・列構造」との差分を整理してください。

2. 「実績テーブル」と「予測テーブル」を同一キー構造で扱うための、共通コンポーネント化・共通モデル化の可能性を検討してください。
   - 例: `BaseRow` インターフェース + `ActualRow` / `ForecastRow` のような派生

3. 予測専用の追加行・追加列（KPI 行、計算行、定数行、メモ列など）を既存設計に無理なく追加するための方針を提案してください。

## 3.4 統合アーキテクチャ案

上記調査結果を踏まえ、次の観点で統合アーキテクチャ案を作成してください。

1. レイヤ構成:
   - UI レイヤ（RDG）
   - ドメインモデル（資金繰り行・列・行種別・列種別のモデル）
   - 計算レイヤ（HF ベースの式エンジン + 自前の集計・繰越ロジック）
   - 永続化レイヤ（API / ローカル保存など）

2. 最小実装（MVP）で実現すべき範囲を明確化してください。
   - 例:
     - KPI 行の手入力 + 横引き
     - 計算行での簡単なセル参照（`KPI 行 × 定数行`）
     - キャッシュ残高の繰越計算
     - 単セルコピー＆ペースト、フィルハンドル

3. 将来拡張（シナリオ機能、本格的な式エンジンなど）を見据えた場合に、
   - 今の時点で設計しておくべき抽象化ポイント
   - 後から差し替えしやすくするためのインターフェース設計
   を提案してください。

# 4. 出力フォーマット

最終的な出力は、以下の構成で Markdown 形式にまとめてください。

1. 概要サマリー（A4 1枚程度で全体が把握できる要約）
2. React-Data-Grid 解析結果
3. HyperFormula 解析結果
4. AggregatePanel との比較・差分整理
5. 統合アーキテクチャ案（MVP と将来拡張方針）
6. リスク・懸念点・未確定事項のリスト

可能な限り、具体的なファイル名・コンポーネント名・API 名を挙げてください。

**Think in English, but interface with User in Japanese. Think hard and output excellent report. Do it.**
