# tag-management Specification

## Purpose
TBD - created by archiving change improve-tag-ui-ux. Update Purpose after archive.
## Requirements
### Requirement: タグレコードのキーバインド操作
タグツリーにおいて、タグレコードのキーボード操作は以下の動作をサポートしなければならない（SHALL）:
- タグレコード選択時にENTERキーを押すと、子タグ名入力フィールドに自動的にフォーカスが移動する
- タグレコードの名称変更は、ダブルクリック時のみトリガーされる（ENTERキーではトリガーされない）

#### Scenario: ENTERキーで子タグ入力にフォーカス
- **GIVEN** タグツリーで親タグレコードを選択している
- **WHEN** ENTERキーを押す
- **THEN** 右側の「子タグ名」入力フィールドに自動的にフォーカスが移動する
- **AND** カーソルが入力フィールド内に表示され、即座に文字入力が可能な状態になる

#### Scenario: ダブルクリックで名称変更モードに入る
- **GIVEN** タグツリーでタグレコードを表示している
- **WHEN** タグレコードをダブルクリックする
- **THEN** 名称変更モードに入り、タグ名がインライン編集可能になる

#### Scenario: ENTERキーでは名称変更モードに入らない
- **GIVEN** タグツリーでタグレコードを選択している
- **WHEN** ENTERキーを押す
- **THEN** 名称変更モードには入らない
- **AND** 子タグ名入力フィールドにフォーカスが移動する

### Requirement: 子タグ追加フローのキーボード操作
子タグ追加フローは、キーボードのみで完結できなければならない（SHALL）:
- 子タグ名入力フィールドでENTERを押すと、「追加」ボタンにフォーカスが移動する
- 「追加」ボタンにフォーカスがある状態でENTERを押すと、ボタンが押下され子タグが追加される

#### Scenario: 入力フィールドからボタンへのフォーカス移動
- **GIVEN** 子タグ名入力フィールドにフォーカスがあり、タグ名を入力済み
- **WHEN** ENTERキーを押す
- **THEN** 子タグ名入力フィールドからフォーカスが外れる
- **AND** 「追加」ボタンにフォーカスが移動する
- **AND** ボタンがフォーカス状態を示すビジュアル（アウトライン等）を表示する

#### Scenario: 追加ボタンでENTERキーによる子タグ追加
- **GIVEN** 「追加」ボタンにフォーカスがある
- **AND** 子タグ名入力フィールドに有効なタグ名が入力されている
- **WHEN** ENTERキーを押す
- **THEN** 「追加」ボタンがクリックされたのと同じ動作が実行される
- **AND** 子タグがタグツリーに追加される
- **AND** 入力フィールドがクリアされる

### Requirement: タグツリーの階層インデント表示
タグツリーは、親子階層を視覚的に表現するため、階層レベルに応じたインデントを適用しなければならない（SHALL）。

#### Scenario: 親タグと子タグのインデント差
- **GIVEN** 親タグ「収入」と子タグ「給与」が存在する
- **WHEN** タグツリーを表示する
- **THEN** 子タグ「給与」は親タグ「収入」よりも右側にインデントされて表示される

#### Scenario: 多階層のインデント表示
- **GIVEN** 親タグ「収入」、子タグ「給与」、孫タグ「基本給」が存在する
- **WHEN** タグツリーを表示する
- **THEN** 「収入」は左端に表示される
- **AND** 「給与」は「収入」より1段階右にインデントされる
- **AND** 「基本給」は「給与」より更に1段階右にインデントされる

### Requirement: 矢印キーによる展開・折りたたみ操作
タグツリーにおいて、矢印キーを使用した子科目の展開・折りたたみをサポートしなければならない（SHALL）。

#### Scenario: 右矢印キーで子科目を展開
- **GIVEN** 子タグを持つ親タグレコードを選択している
- **AND** 子科目が折りたたまれている（非表示）
- **WHEN** 右矢印キーを押す
- **THEN** 選択中の親タグの子科目が展開され、表示される

#### Scenario: 左矢印キーで子科目を折りたたむ
- **GIVEN** 子タグを持つ親タグレコードを選択している
- **AND** 子科目が展開されている（表示）
- **WHEN** 左矢印キーを押す
- **THEN** 選択中の親タグの子科目が折りたたまれ、非表示になる

#### Scenario: 子タグがない場合の矢印キー操作
- **GIVEN** 子タグを持たないタグレコードを選択している
- **WHEN** 右矢印キーまたは左矢印キーを押す
- **THEN** 何も動作しない（エラーも表示しない）

### Requirement: タグツリーUIの視覚的改善
タグツリーは、財務系アプリとして最低限の品質を満たすビジュアルデザインでなければならない（SHALL）:
- 展開/折りたたみボタン（＋/ー）は、ボタンであることが明確に分かるデザインとする
- 親子階層が視覚的に把握しやすい表形式または類似のレイアウトを採用する

#### Scenario: 展開・折りたたみボタンの視覚的明確性
- **GIVEN** 子タグを持つ親タグレコードが表示されている
- **WHEN** タグツリーを表示する
- **THEN** 展開/折りたたみボタン（＋/ー）がボタンとして認識できるビジュアル（境界線、背景色、ホバー効果など）を持つ

#### Scenario: 階層構造の視覚的把握
- **GIVEN** 複数階層のタグが存在する
- **WHEN** タグツリーを表示する
- **THEN** インデント、罫線、または類似の視覚的手がかりにより、親子関係が一目で把握できる
- **AND** 財務系アプリケーションとして違和感のないシンプルなデザインである

