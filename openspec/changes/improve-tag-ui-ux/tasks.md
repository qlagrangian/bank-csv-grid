# Implementation Tasks

## 1. タグツリーのキーバインド改善

- [ ] 1.1 タグレコード選択時のENTERキーハンドラを修正（名称変更ではなく、子タグ入力フィールドへフォーカス移動）
- [ ] 1.2 タグレコードのダブルクリックハンドラを実装（名称変更モードに入る）
- [ ] 1.3 子タグ名入力フィールドでのENTERキーハンドラを実装（「追加」ボタンへフォーカス移動）
- [ ] 1.4 「追加」ボタンのフォーカス状態管理とENTERキーハンドラを実装
- [ ] 1.5 フォーカス管理のReact Refs設定とフォーカス移動ロジックを実装

## 2. タグツリーの階層インデント表示

- [ ] 2.1 タグレコードの階層レベルを計算する関数を実装
- [ ] 2.2 階層レベルに応じたインデントスタイルをCSSまたはインラインスタイルで適用
- [ ] 2.3 多階層タグの表示を確認し、視覚的な親子関係を検証

## 3. 矢印キーによる展開・折りたたみ操作

- [ ] 3.1 タグツリーコンポーネントに展開/折りたたみ状態を管理するStateを追加
- [ ] 3.2 右矢印キーハンドラを実装（子科目を展開）
- [ ] 3.3 左矢印キーハンドラを実装（子科目を折りたたむ）
- [ ] 3.4 子タグがない場合の矢印キー操作を無視する処理を追加
- [ ] 3.5 展開/折りたたみ状態に応じたタグツリーのレンダリング更新

## 4. タグツリーUIの視覚的改善

- [ ] 4.1 展開/折りたたみボタン（＋/ー）のスタイルを改善（境界線、背景色、ホバー効果）
- [ ] 4.2 タグツリー全体のレイアウトを表形式またはそれに類するデザインに変更
- [ ] 4.3 親子階層が把握しやすいよう、罫線または類似の視覚的手がかりを追加
- [ ] 4.4 財務系アプリとして違和感のないシンプルなデザインに調整

## 5. Pending状態のタグ編集機能

- [ ] 5.1 Pending状態（黄色表示）のタグセルでのダブルクリックハンドラを実装
- [ ] 5.2 Pending状態のタグセルでのENTERキーハンドラを実装
- [ ] 5.3 ポップアップ表示時に現在のタグ割り当て状態を反映するロジックを追加

## 6. DB登録済みタグの編集機能

- [ ] 6.1 DB登録済み（緑色表示）のタグセルでのダブルクリックハンドラを実装
- [ ] 6.2 DB登録済みのタグセルでのENTERキーハンドラを実装
- [ ] 6.3 タグ編集時にレコードの状態を緑色からPending（黄色）に戻すロジックを実装
- [ ] 6.4 編集後のタグ割り当て状態を内部的に保持する機構を追加

## 7. 内部勘定割り当てボタンによるDB反映制御

- [ ] 7.1 新規タグ割り当て時にDB反映を保留し、Pending状態を維持する処理を確認
- [ ] 7.2 「内部勘定割り当て」ボタン押下時に、Pending状態の全タグをDBに一括保存するAPIコールを実装
- [ ] 7.3 DB保存成功後、Pending（黄色）レコードを登録済み（緑色）に更新
- [ ] 7.4 編集後のタグもボタン押下でDB更新されることを確認

## 8. タグ割り当てポップアップのENTERキー確定

- [ ] 8.1 ポップアップ内のタグツリーでタグ選択時のENTERキーハンドラを実装
- [ ] 8.2 ENTERキー押下時に選択中のタグを取引レコードに割り当てる処理を実装
- [ ] 8.3 タグ割り当て後、ポップアップを自動的に閉じる処理を追加
- [ ] 8.4 タグ未選択時のENTERキー動作（ポップアップを閉じるのみ）を実装
- [ ] 8.5 複数タグ選択が可能な場合、全選択タグを割り当てる処理を実装

## 9. タグ割り当てポップアップの画面中央配置

- [ ] 9.1 ポップアップのCSSスタイルを修正（position: fixed、中央配置）
- [ ] 9.2 画面サイズに応じた適切なポップアップサイズ調整を実装
- [ ] 9.3 小さい画面でのポップアップ表示とスクロールバー対応を確認
- [ ] 9.4 スクロール位置に関わらず常に中央に固定表示されることを検証

## 10. テストと検証

- [ ] 10.1 タグツリーのキーボード操作フローを手動テスト（ENTER、矢印キー、ダブルクリック）
- [ ] 10.2 タグ割り当ての編集・再編集・DB反映フローを手動テスト
- [ ] 10.3 Pending状態とDB登録済み状態の遷移を検証
- [ ] 10.4 ポップアップのENTERキー確定と画面中央配置を検証
- [ ] 10.5 各ブラウザでの動作確認（Chrome、Safari、Firefox）
- [ ] 10.6 必要に応じてユニットテストを追加（キーボードイベントハンドラ、状態管理）

## 11. ドキュメント更新

- [ ] 11.1 CLAUDE.mdに新しいキーボード操作の説明を追加
- [ ] 11.2 ユーザーガイドまたはREADMEにタグ管理のUX改善内容を記載
