# Change: タグ管理とタグ割り当てのUI/UX改善

## Why

現状のタグ管理UIとタグ割り当て機能は基本的な機能は実装されているものの、キーボード操作の効率性や視覚的な階層表現、編集フローの直感性において改善の余地がある。特に以下の課題が存在する:

1. **タグツリーのキーバインドが非効率**: ENTERキーで名称変更が起動するため、頻度の高い「子タグ追加」操作への導線が遠い
2. **階層構造の視覚的表現が弱い**: 親子関係が＋/ーボタンのみで表現され、インデントがないため階層が把握しづらい
3. **タグ割り当ての編集フローが中途半端**: Pending状態（黄色）で編集できず、またDB登録済み（緑色）のタグも再編集できない
4. **ポップアップの操作性が低い**: ENTERキーで確定できず、表示位置も最適化されていない

これらの改善により、財務系アプリとして必要最低限のUIの質を確保し、日常的なタグ管理・割り当て作業の効率を大幅に向上させる。

## What Changes

### タグツリー部・登録機能のキーバインド改善
- タグレコードの名称変更トリガーを**ダブルクリックのみ**に変更（ENTERでは起動しない）
- タグレコード選択時にENTERを押すと、**子タグ名入力フィールドに自動フォーカス**
- 入力フィールドでENTERを押すと、**「追加」ボタンにフォーカス移動**
- 「追加」ボタンフォーカス時にENTERで**ボタン押下実行**
- コアロジックは変更せず、フォーカス管理とイベントハンドリングのみ修正

### タグツリー部・タグ表示UIの改善
- 親子階層を**インデント表示**に変更（子科目ほど右にずれる）
- レコード選択時に**右矢印キーで子科目を展開**、**左矢印キーで折りたたみ**
- ＋/ーをボタンらしいビジュアルに改善（財務系アプリとして最低限の質）
- 階層構造が視覚的に把握しやすいレイアウトに改良（表形式など）

### 表における「タグ割り当て」のPending状態管理
- **Pending状態（黄色）のタグをダブルクリック/ENTERで再編集可能**に
- **「内部勘定割り当て」ボタン押下までDB反映を保留**（現状の動作を強化）
- **DB登録済み（緑色）のタグもダブルクリック/ENTERで編集可能**に
- 編集すると再度黄色（Pending）に戻り、ボタン押下で修正をDB反映

### タグ割り当てポップアップの操作性改善
- ポップアップ内でタグ選択後、**ENTERキーで選択を確定**（現状は閉じるのみ）
- ポップアップの表示位置を**画面中央部に固定**（視認性向上）

## Impact

**影響を受けるcapabilities:**
- `tag-management` - タグツリーの表示・編集・キーボード操作
- `transaction-tagging` - 取引へのタグ割り当てUI・Pending状態管理

**影響を受けるコード:**
- タグツリーコンポーネント（`src/components/tags/TagTree.tsx` など）
- タグ割り当てポップアップ（`src/components/transactions/TagAssignmentModal.tsx` など）
- タグ割り当て状態管理hooks（`src/hooks/useTagAssignment.ts` など）
- TransactionGridコンポーネント（`src/components/transactions/TransactionGrid.tsx`）

**破壊的変更:** なし（既存のコアロジック・データモデルは維持）

**ユーザー体験への影響:**
- タグ管理作業の効率が大幅に向上
- キーボード中心の操作フローが確立
- 階層構造の視認性向上により、ミスが減少
- タグ割り当ての編集・修正が柔軟になる
